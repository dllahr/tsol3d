<html>
<head>
<script src="https://3Dmol.csb.pitt.edu/build/3Dmol.js"></script>
</head>
<body>
<h2>Tertiary structure TIM (PDB 4POC) monomer</h2>
<input type="submit" value="ribbon" onclick="swapView(this.value)"/>
<input type="submit" value="ribbon and surface" onclick="swapView(this.value)"/>
<input type="submit" value="ribbon and interacting amino acids" onclick="swapView(this.value)"/>
<input type="submit" value="ribbon and interacting amino acids as spheres" onclick="swapView(this.value)"/><br/>
<input type="submit" value="ribbon with amino acids colored by side chain properties" onclick="swapView(this.value)"/>
<input type="submit" value="stick with amino acids colored by side chain properties" onclick="swapView(this.value)"/>

<div id="3DMolViewerDiv" style="height: 600px; width: 600px; position: relative;"></div>

</body>
<script>
var swapViewer = null;
var pdbData = null;

var residueIndexes = [68,111,49,53,187,140,213,216,38,205];

function swapView(viewName) {
	console.log("swapView viewName:  " + viewName);

	swapViewer.removeAllModels();
	swapViewer.removeAllShapes();
	swapViewer.removeAllLabels();
	swapViewer.removeAllSurfaces();
	swapViewer.addModel(pdbData, "pdb", {keepH:true});

	if ("ribbon" == viewName) {
		swapViewer.setStyle({}, {cartoon:{color:"spectrum", arrows:true}});
	} else if ("ribbon and surface" == viewName) {
		swapViewer.setStyle({}, {cartoon:{color:"spectrum", arrows:true}});
        	swapViewer.addSurface("VDW", {opacity:0.8,color:"white"});
	} else if ("ribbon and interacting amino acids" == viewName) {
		swapViewer.setStyle({}, {cartoon:{color:"spectrum", arrows:true}});
                swapViewer.setStyle({resi:residueIndexes}, {stick:{}, cartoon:{color:"spectrum", arrows:true}});
		swapViewer.addResLabels({resi:residueIndexes}, {font:"Helvetica", fontSize:18, fontColor:"black", showBackground:false});

		//add H-bonding
		var myModel = swapViewer.getModel();

		var pairSerialNumbers = [[1020,1642],[706,781],[2822,2067],[3214,3240],[547,3103],[547,3101]];
		for (var i = 0; i < pairSerialNumbers.length; i++) {
			var pairAtoms = myModel.selectedAtoms({serial:pairSerialNumbers[i]});
			//console.log(pairSerialNumbers);
			//console.log(pairAtoms);

			var p0 = pairAtoms[0];
			var p1 = pairAtoms[1];

			swapViewer.addLine({dashed:true, start:{x:p0.x, y:p0.y, z:p0.z}, end:{x:p1.x, y:p1.y, z:p1.z},
				linewidth:10, dashLength:0.25, gapLength:0.25});
		}	
	} else if ("ribbon and interacting amino acids as spheres" == viewName) {
		swapViewer.setStyle({}, {cartoon:{color:"spectrum", arrows:true}});
                swapViewer.setStyle({resi:residueIndexes}, {sphere:{}, cartoon:{color:"spectrum", arrows:true}});
		swapViewer.addResLabels({resi:residueIndexes}, {font:"Helvetica", fontSize:18, fontColor:"black", showBackground:false});
	} else if ("ribbon with amino acids colored by side chain properties" == viewName) {
		swapViewer.setStyle({resn:["ALA","PHE","ILE","LEU","MET","VAL","TRP","TYR","CYS"]}, {cartoon:{color:"purple", arrows:true}});
		swapViewer.setStyle({resn:["ASN","GLN","SER","THR","GLY"]}, {cartoon:{color:"lime", arrows:true}});
		swapViewer.setStyle({resn:["HIS","LYS","ARG","ASP","GLU","PRO"]}, {cartoon:{color:"silver", arrows:true}});
	} else if ("stick with amino acids colored by side chain properties" == viewName) {
		swapViewer.setStyle({resn:["ALA","PHE","ILE","LEU","MET","VAL","TRP","TYR","CYS"]}, {stick:{color:"purple"}});
		swapViewer.setStyle({resn:["ASN","GLN","SER","THR","GLY"]}, {stick:{color:"lime"}});
		swapViewer.setStyle({resn:["HIS","LYS","ARG","ASP","GLU","PRO"]}, {stick:{color:"silver"}});
	}
	swapViewer.render();
};

$(document).ready(function() {
	swapViewer = $3Dmol.createViewer("3DMolViewerDiv");
	
	$.ajax({url: "https://www.broadinstitute.org/~dlahr/tsol_3dmol/4poc chain A monomer.pdb", success: function(_4PocPdb) {
		pdbData = _4PocPdb;

		swapViewer.setBackgroundColor(0xffffff);
		swapView("ribbon");
		swapViewer.zoomTo();
		swapViewer.render();
	}});
})
</script>
</html>
